<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Amazon Warehouses Mapping</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script type="text/javascript" src="../d3.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
    <link rel="stylesheet" href='styles.css'/>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <style>

    </style>
  </head>
  <body>
    <nav id="menu"></nav>
    <a target='_blank' class="chartB w3-button w3-padding-small" id="button1" 
    style = "font-size: 0.8em" href="./urban_chart.html">Chart</a>

    <a target='_blank' class="chartB w3-button w3-padding-small w3-" id="button2" 
    style = "font-size: 0.8em"  href="./suburban_chart.html">Chart</a>

    <a target='_blank' class="chartB w3-button w3-padding-small w3-" id="button3" 
    style = "font-size: 0.8em"  href="./rural_chart.html">Chart</a>

    <div id="map-us"></div>


    
    <div class='map-overlay2' id='legend'> 
        <p style = 'margin-top: 0; font-size:1em'> Percentile Ranking of Socio-econ Indicator in 2018 SVI Data</p>

        <div class='row colors1'></div>
        <div class='row labels'>
           <div class = 'label1'>0</div>
           <div class = 'label1'>10%</div>
           <div class = 'label1'>20%</div>
           <div class = 'label1'>30%</div>
           <div class = 'label1'>40%</div>
           <div class = 'label1'>50%</div>
           <div class = 'label1'>60%</div>
           <div class = 'label1'>70%</div>
           <div class = 'label1'>80%</div>
           <div class = 'label1'>90%</div>
           <div class = 'label1'>100%</div>
        </div>

      <p style = 'margin-top: 3; font-size:1em'>Percentage Change of Socio-econ Indicator from 2014 to 2018</p>

      <div class='row colors2'></div>
      <div class='row labels'>
         <div class = 'label2'>-50%</div>
         <div class = 'label2'>-40%</div>
         <div class = 'label2'>-30%</div>
         <div class = 'label2'>-20%</div>
         <div class = 'label2'>-10%</div>
         <div class = 'label2'>0</div>
         <div class = 'label2'>10%</div>
         <div class = 'label2'>20%</div>
         <div class = 'label2'>30%</div>
         <div class = 'label2'>40%</div>
         <div class = 'label2'>50%</div>
      </div>
      <p style="font: size 0.7; em;font-style: italic">Indicator = EPL_POV + EPL_UNEMP + EPL_PCI + EPL_NOHSDP<br>
    Bigger number means bigger social-economic vulnerability</p>

  </div>
    <div id="intro">
      <section id="left-intro">
        <h3>Counties With Amazon Warehouses</h3>
        <h5><em>by Jacob Hu | Shuang Bi | Yuan Li</em></h5>
        <p>When everything came to a halt during this pandemic, Amazon speeded up its operation...<br>
            The company refused to shut down their facilities, taking advantage of the economic desperation caused by COVID to increase its market dominance.<br>
            By 2021, there will be <b>498</b> Amazon warehouses in the U.S., across <b>204</b> counties and <b>42</b> states.<br>
            Looking at the sociol economic indicator from <a href="https://www.atsdr.cdc.gov/placeandhealth/svi/index.html">CDC SVI data </a>in counties with Amazon warehouses, <br>
            we found that Amazon came to the relatively vulnerable communites and local SVI improved from 2014 to 2018, 
            It aligned with the reason why local government invited Amazon, but was not sufficient to describe the 
            <a href="https://www.ufcw.org/press-releases/ftcamazon/#:~:text=%E2%80%9CAmazon%20represents%20a%20clear%20and,employees%20throughout%20its%20distribution%20centers.">>deteriorated working conditions</a> in these warehouses...
        </p>
        <hr>
        <p><b>To get started, please use the toggle menu above.<b></p>
      </section>
    </div>
    <section class="data">

      <!-- Main script -->
      <script>
      //this part of the example can be found at mapbox: https://docs.mapbox.com/mapbox-gl-js/example/simple-map/
      //you will find the accessToken and the style for your map under "Share" in your specific map in mapbox studio
      mapboxgl.accessToken = 'pk.eyJ1IjoieWgzMTc1IiwiYSI6ImNraGdjYzR5aDBnNG4ycXFkOXc5a3U0cDQifQ.fcl-Godi2KXbDishUgaFSg';



      //mapbox
      var map = new mapboxgl.Map({
        container: 'map-us',//thi sis the div that you have mad above in html that you are now placing your map in
        style: 'mapbox://styles/yh3175/ckhgchrpn1c1m19pmfy0vveta',//you will find the accessToken under "Share" in your specific map in mapbox studio
        center: [-104, 38],//the center of the map can be set to any initial value of [lng,lat]
        zoom: 4//note that some layers have zoom limits - for example, streets and building footprints are not visible when zoomed out
      });

        //COUNTIES
        //load counties file:
        map.on('load', function () {

          //add data:
          map.addSource('counties',{
            'type':'geojson',
            'data':'Data/Amzn_Counties3.geojson'
          });

          //counties shape colors by SPL data:
          map.addLayer({
            'id':'2018 SVI',
            'type':'fill',
            'source':'counties',
            'layout':{
              'visibility':'none'
            },
            'paint':{
              'fill-color': [
              'interpolate',
              ['linear'],
              ['get', 'amzfilter_RPL_THEME4_1'],
              0,
              '#55552b',
              0.1,
              '#888844',
              0.2,
              '#bbbb77',
              0.3,
              '#ddddbb',
              0.4,
              '#ffffff',
              0.5,
              '#f0b27a',
              0.6,
              '#df9f9f',
              0.7,
              '#c65353',
              0.8,
              '#993333',
              0.9,
              '#602020'
              ],
              'fill-opacity': 0.75
              }
        });

        map.addLayer({
          'id':'2014 SVI',
          'type':'fill',
          'source':'counties',
          'layout':{
            'visibility':'none'
          },
          'paint':{
            'fill-color': [
            'interpolate',
            ['linear'],
            ['get', 'amzfilter_RPL_THEME4_1'],
            0,
              '#55552b',
              0.1,
              '#888844',
              0.2,
              '#bbbb77',
              0.3,
              '#ddddbb',
              0.4,
              '#ffffff',
              0.5,
              '#f0b27a',
              0.6,
              '#df9f9f',
              0.7,
              '#c65353',
              0.8,
              '#993333',
              0.9,
              '#602020'
              ],
            'fill-opacity': 0.75
            }
        });

        map.addLayer({
          'id':'SVI Change',
          'type':'fill',
          'source':'counties',
          'layout':{
            'visibility':'none'
          },
          'paint':{
            'fill-color': [
            'interpolate',
            ['linear'],
            ['get', 'amzfilter_RPL_THEME1_3'],
            -0.5,
            '#1e8449',
            -0.4,
            '#27ae60',
            -0.3,
            '#52be80',
            -0.2,
            '#a9dfbf',
            -0.1,
            '#d4efdf',
            0,
            '#fdfefe',
            0.1,
            '#fadbd8',
            0.2,
            '#f1948a',
            0.3,
            '#ec7063',
            0.4,
            '#e74c3c',
            0.5,
            '#b03a2e',
            ],
            'fill-opacity': 0.75
            }
        });

        // counties shape data for population:
        map.addLayer({
          'id':'Micropolitan',
          'type':'fill',
          'source':'counties',
          'filter': ['<=', 'amzfilter_E_TOTPOP_1', 49999],
          'layout':{
            'visibility':'none'
          },
          'paint':{
            'fill-color': [
              'interpolate',
              ['linear'],
              ['get', 'amzfilter_RPL_THEME1_3'],
              -0.5,
            '#1e8449',
            -0.4,
            '#27ae60',
            -0.3,
            '#52be80',
            -0.2,
            '#a9dfbf',
            -0.1,
            '#d4efdf',
            0,
            '#fdfefe',
            0.1,
            '#fadbd8',
            0.2,
            '#f1948a',
            0.3,
            '#ec7063',
            0.4,
            '#e74c3c',
            0.5,
            '#b03a2e',
              ],
              'fill-opacity': 0.75
              }
        });

        map.addLayer({
          'id':'Small Metro',
          'type':'fill',
          'source':'counties',
          'filter': ['all',
            ['>', 'amzfilter_E_TOTPOP_1', 49999],
            ['<=', 'amzfilter_E_TOTPOP_1', 250000]
          ],
          'layout':{
            'visibility':'none'
          },
          'paint':{
            'fill-color': [
              'interpolate',
              ['linear'],
              ['get', 'amzfilter_RPL_THEME1_3'],
              -0.5,
            '#1e8449',
            -0.4,
            '#27ae60',
            -0.3,
            '#52be80',
            -0.2,
            '#a9dfbf',
            -0.1,
            '#d4efdf',
            0,
            '#fdfefe',
            0.1,
            '#fadbd8',
            0.2,
            '#f1948a',
            0.3,
            '#ec7063',
            0.4,
            '#e74c3c',
            0.5,
            '#b03a2e',
            ],
            'fill-opacity': 0.75
          }
        });

        map.addLayer({
          'id':'Medium Metro',
          'type':'fill',
          'source':'counties',
          'filter': ['all',
            ['>', 'amzfilter_E_TOTPOP_1', 250000],
            ['<=', 'amzfilter_E_TOTPOP_1', 999999]
          ],
          'layout':{
            'visibility':'none'
          },
          'paint':{
            'fill-color': [
              'interpolate',
              ['linear'],
              ['get', 'amzfilter_RPL_THEME1_3'],
              -0.5,
            '#1e8449',
            -0.4,
            '#27ae60',
            -0.3,
            '#52be80',
            -0.2,
            '#a9dfbf',
            -0.1,
            '#d4efdf',
            0,
            '#fdfefe',
            0.1,
            '#fadbd8',
            0.2,
            '#f1948a',
            0.3,
            '#ec7063',
            0.4,
            '#e74c3c',
            0.5,
            '#b03a2e',
            ],
            'fill-opacity': 0.75
          }
        });

        map.addLayer({
          'id':'Large Metro',
          'type':'fill',
          'source':'counties',
          'filter': ['>', 'amzfilter_E_TOTPOP_1', 999999],
          'layout':{
            'visibility':'none'
          },
          'paint':{
            'fill-color': [
              'interpolate',
              ['linear'],
              ['get', 'amzfilter_RPL_THEME1_3'],
              -0.5,
            '#1e8449',
            -0.4,
            '#27ae60',
            -0.3,
            '#52be80',
            -0.2,
            '#a9dfbf',
            -0.1,
            '#d4efdf',
            0,
            '#fdfefe',
            0.1,
            '#fadbd8',
            0.2,
            '#f1948a',
            0.3,
            '#ec7063',
            0.4,
            '#e74c3c',
            0.5,
            '#b03a2e',
            ],
            'fill-opacity': 0.75
          }
        });


        //toggle - below -

        //toggle menu variable:
        //future variables:['population','THEME4','lgmetro', 'mdmetro',
        //'smmetro','micropolitan','noncore']

        var toggleableLayerIds = ['SVI Change', '2018 SVI', '2014 SVI',
        'Micropolitan', 'Small Metro', 'Medium Metro', 'Large Metro'];

        //toggle script:
        for (var i = 0; i < toggleableLayerIds.length; i++) {
          var id = toggleableLayerIds[i];

          var link = document.createElement('a');

          if (i == 0) {
            link.href = '#';
            link.className = 'active';
            link.textContent = id;
            map.setLayoutProperty('SVI Change', 'visibility', 'visible');
          } else {
            link.href = '#';
            link.className = '';
            link.textContent = id;
          }

          link.onclick = function (e) {
            var clickedLayer = this.textContent;
            e.preventDefault();
            e.stopPropagation();

            var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

            //map zooms out
            map.flyTo({
              center: [-104, 38],
              zoom: 4
            });

            //show intro paragraph once map zooms out again
            document.getElementById('intro').style.visibility = "visible";

            // toggle layer visibility by changing the layout object's visibility property
            if (visibility === 'visible') {
              map.setLayoutProperty(clickedLayer, 'visibility', 'none');
              this.className = '';
              document.getElementById('intro').style.visibility = "visible";
            } else {
              this.className = 'active';
              map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
            }
          };

          var layers = document.getElementById('menu');
          layers.appendChild(link);
        };

        //on-click functions
        //on click SVI figures
        map.on('click', '2018 SVI', function (e) {
          map.flyTo({
            center: e.lngLat,
            zoom: 9
          });
          document.getElementById('intro').style.visibility = "hidden";
          new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML((e.features[0].properties.amzfilter_RPL_THEME4_1).toFixed(4)*100+'%')
          .addTo(map);
        });

        map.on('click', '2014 SVI', function (e) {
          map.flyTo({
            center: e.lngLat,
            zoom: 9
          });
          document.getElementById('intro').style.visibility = "hidden";
          new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML((e.features[0].properties.amzfilter_RPL_THEME4_1).toFixed(4)*100+'%')
          .addTo(map);
        });

        map.on('click', 'SVI Change', function (e) {
          map.flyTo({
            center: e.lngLat,
            zoom: 9
          });
          document.getElementById('intro').style.visibility = "hidden";
          var p = e.features[0].properties;
          new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML((p.amzfilter_RPL_THEME1_3).toFixed(4)*100 + '% Change')
          .addTo(map);
        });

        //on click county population:
        map.on('click', 'Micropolitan', function(e) {
          map.flyTo({
            center: e.lngLat,
            zoom: 9
          });
          document.getElementById('intro').style.visibility = "hidden";
          new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML((e.features[0].properties.amzfilter_RPL_THEME1_3).toFixed(4)*100 + '% Change')
          .addTo(map);
        });
        map.on('click', 'Small Metro', function(e) {
          map.flyTo({
            center: e.lngLat,
            zoom: 9
          });
          document.getElementById('intro').style.visibility = "hidden";
          new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML((e.features[0].properties.amzfilter_RPL_THEME1_3).toFixed(4)*100 + '% Change')
          .addTo(map);
        });
        map.on('click', 'Medium Metro', function(e) {
          map.flyTo({
            center: e.lngLat,
            zoom: 9
          });
          document.getElementById('intro').style.visibility = "hidden";
          new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML((e.features[0].properties.amzfilter_RPL_THEME1_3).toFixed(4)*100 + '% Change')
          .addTo(map);
        });
        map.on('click', 'Large Metro', function(e) {
          map.flyTo({
            center: e.lngLat,
            zoom: 9
          });
          document.getElementById('intro').style.visibility = "hidden";
          new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML((e.features[0].properties.amzfilter_RPL_THEME1_3).toFixed(4)*100 + '% Change')
          .addTo(map);
        });

        //mouseover
        map.on('mouseenter', '2018 SVI', function () {
          map.getCanvas().style.cursor = 'pointer';
        });
        map.on('mouseenter', '2014 SVI', function () {
          map.getCanvas().style.cursor = 'pointer';
        });
        map.on('mouseenter', 'SVI Change', function () {
          map.getCanvas().style.cursor = 'pointer';
        });
        map.on('mouseenter', 'Micropolitan', function () {
          map.getCanvas().style.cursor = 'pointer';
        });
        map.on('mouseenter', 'Small Metro', function () {
          map.getCanvas().style.cursor = 'pointer';
        });
        map.on('mouseenter', 'Medium Metro', function () {
          map.getCanvas().style.cursor = 'pointer';
        });
        map.on('mouseenter', 'Large Metro', function () {
          map.getCanvas().style.cursor = 'pointer';
        });

        // Change it back to a pointer when it leaves.
        map.on('mouseleave', '2018 SVI', function () {
          map.getCanvas().style.cursor = '';
        });
        map.on('mouseleave', '2014 SVI', function () {
          map.getCanvas().style.cursor = '';
        });
        map.on('mouseleave', 'SVI Change', function () {
          map.getCanvas().style.cursor = '';
        });
        map.on('mouseleave', 'Micropolitan', function () {
          map.getCanvas().style.cursor = '';
        });
        map.on('mouseleave', 'Small Metro', function () {
          map.getCanvas().style.cursor = '';
        });
        map.on('mouseleave', 'Medium Metro', function () {
          map.getCanvas().style.cursor = '';
        });
        map.on('mouseleave', 'Large Metro', function () {
          map.getCanvas().style.cursor = '';
        });
      });

      </script>
    </section>
  </body>
</html>
